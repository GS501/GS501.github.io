!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(require("react"),require("react-dom"),require("react-redux"),require("foundation"),require("user"),require("classnames"),require("hammerjs"),require("@tweenjs/tween.js"),require("redux"),require("redux-thunk")):"function"==typeof define&&define.amd?define(["react","react-dom","react-redux","foundation","user","classnames","hammerjs","@tweenjs/tween.js","redux","redux-thunk"],t):t((e=e||self).React,e.ReactDOM,e.ReactRedux,e.Foundation,e.User,e.classNames,e.Hammer,e.TWEEN,e.Redux,e.ReduxThunk)}(this,function(s,c,e,l,k,O,b,w,a,u){"use strict";var P="default"in s?s.default:s;c=c&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c,O=O&&Object.prototype.hasOwnProperty.call(O,"default")?O.default:O,b=b&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b,w=w&&Object.prototype.hasOwnProperty.call(w,"default")?w.default:w,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u;function z(e){l.track("impression",{module:{name:e,region:1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",label:2<arguments.length&&void 0!==arguments[2]?arguments[2]:"",context:3<arguments.length&&void 0!==arguments[3]?arguments[3]:""}})}var C=function(t){return new Promise(function(e){setTimeout(e,t)})};function d(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||r(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function n(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?t(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):t(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function o(e){return function(e){if(Array.isArray(e))return i(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||r(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){if(e){if("string"==typeof e)return i(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?i(e,t):void 0}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(t,n,e){return e.some(function(e){return function(e,t,n,r){var o=d(e,2),a=o[0],i=o[1],c=d(t,2),s=c[0],l=c[1],u=d(n,2),e=u[0],o=u[1],t=d(r,2),c=t[0],n=t[1],u=(s-a)*(n-o)-(c-e)*(l-i);if(0==u)return a===e&&i===o&&s===c&&l===n||a===c&&i===n&&s===e&&l===o;r=((n-o)*(c-a)+(e-c)*(n-i))/u,t=((i-l)*(c-a)+(s-a)*(n-i))/u;if(!(0<r&&r<1&&0<t&&t<1))return!1;u=function(e,t){return(t[1]-e[1])/(t[0]-e[0])},r=u([a,i],[s,l]),t=i-a*r,u=u([e,o],[c,n]),u=(o-e*u-t)/(r-u),t=r*u+t,t=[Math.round(u),Math.round(t)].toString(),i=[Math.round(a),Math.round(i)].toString(),l=[Math.round(s),Math.round(l)].toString(),o=[Math.round(e),Math.round(o)].toString(),n=[Math.round(c),Math.round(n)].toString();return!(i===t||l===t||o===t||n===t)}(e.a,e.b,t,n)})}function S(t,e){return{get:function(){return this.hasOwnProperty(t)||(this[t]=e),this[t]},set:function(e){this[t]=e,this.update()}}}function _(e){return e.touches&&1<e.touches.length}var x=function(t,e){return e.some(function(e){return e.includes(t[0])&&e.includes(t[1])})},m=function(e,t,n){return x(n,e)&&(e=e,r=[].concat(o(t),[n]),e.every(function(e){return x(e,r)}));var r},p=function(t,n){var r=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:[]).map(function(e){return e.toString()}),o=[];return Object.keys(t).forEach(function(e){t[e].lines.forEach(function(e){e.includes(parseInt(n))&&(e=e.toString(),o.includes(e)||r.includes(e)||o.push(e))})}),o.length},h=function(n,e){var t=e.drawnLines,r=e.drawnShapes,o=e.shapes,a=[],i=[],c=r.map(function(e){return o[e].lines.map(function(e){return e})}).flat();return t.forEach(function(e){var t;e.includes(n)&&!x(e,c)?(t=n===e[0]?e[1]:e[0],i.push(t)):a.push(e)}),{drawnLines:a,otherVertices:i}},f=function(t,e,n){var r={};return e.forEach(function(e){r[e]=t.pendingConnections[e]+1}),r[n]=t.pendingConnections[n]+e.length,r},v=function(e,t){if(0===Object.keys(t).length)return e.pendingConnections;var r=n({},e.pendingConnections),o=t.drawnLines.flat();return Object.keys(r).forEach(function(n){var e=o.reduce(function(e,t){return t===parseInt(n)?e+1:e},0);r[n]-=e}),r},A=function(e,t){return e===t[t.length-1].id};function g(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function T(){return Math.floor(Date.now()/1e3)}function j(e){return 0===Object.keys(e).length}function L(e,t){D(e,t),N(e,t)}var D=function(e,t){try{window.localStorage.setItem("vertexPackCompletion",JSON.stringify({pack_id:e,is_complete:t,timestamp:T()}))}catch(e){console.error("Vertex: Failed to save local pack completion:",e)}},N=function(e,t){return l.xhr.post("".concat(l.env.api,"/svc/vertex/v1/game/store-completion"),{pack_id:e,is_complete:t,timestamp:T()}).catch(function(e){console.error("Vertex: Failed to save remote pack completion:",e)})},I=function(){var o=function(){try{var e=JSON.parse(window.localStorage.getItem("vertexPackCompletion"));return e?{packId:e.pack_id,isComplete:e.is_complete,timestamp:e.timestamp}:{}}catch(e){return console.error("Vertex: Failed to get local pack completion:",e),null}}();return l.xhr.get("".concat(l.env.api,"/svc/vertex/v1/game/recent-pack-completion.json")).then(function(e){return{packId:e.pack_id,isComplete:e.is_complete,timestamp:e.timestamp}}).catch(function(e){return console.error("Vertex: Failed to get remote pack completion",e),{}}).then(function(e){if(j(e))return o;var t=j(o)?0:o.timestamp,n=j(e)?0:e.timestamp;if(0===t&&0===n)return{};if(t<n){var n=e.packId,r=e.isComplete;return D(n,r),e}r=o.packId,e=o.isComplete;return N(r,e),o})},M=function(e){var t=e.id,n=e.packId,r=e.puzzleType,o=e.isComplete,a=e.drawnLines,e=e.drawnShapes;try{var i={puzzle_id:t,pack_id:n,puzzle_type:r,is_complete:o,drawn_lines:a,drawn_shapes:e,timestamp:T()};"daily"===r?window.localStorage.setItem("vertexProgress",JSON.stringify(i)):window.localStorage.setItem("vertexPackProgress",JSON.stringify([i]))}catch(e){console.error("Vertex: Failed to save local progress:",e)}},R=function(e){var t=e.id,n=e.packId,r=e.puzzleType,o=e.isComplete,a=e.drawnLines,e=e.drawnShapes;return l.xhr.post("".concat(l.env.api,"/svc/vertex/v1/game/store-progress"),{puzzle_id:t,pack_id:n,puzzle_type:r,is_complete:o,drawn_lines:a,drawn_shapes:e,timestamp:T()}).catch(function(e){console.error("Vertex: Failed to save remote progress:",e)})},F=function(e){var r=function(e){try{var t=JSON.parse(window.localStorage.getItem("vertexProgress"));return t&&t.puzzle_id===e?{id:t.puzzle_id,packId:t.pack_id,puzzleType:t.puzzle_type,timestamp:t.timestamp,isComplete:t.is_complete,drawnLines:Array.isArray(t.drawn_lines)?t.drawn_lines:[],drawnShapes:Array.isArray(t.drawn_shapes)?t.drawn_shapes:[]}:{}}catch(e){return console.error("Vertex: Failed to get local progress:",e),{}}}(e);return e=e,l.xhr.get("".concat(l.env.api,"/svc/vertex/v1/game/puzzle-progress/").concat(e,".json")).then(function(e){return{id:e.puzzle_id,packId:e.pack_id,puzzleType:e.puzzle_type,timestamp:e.timestamp,isComplete:e.is_complete,drawnLines:Array.isArray(e.drawn_lines)?e.drawn_lines:[],drawnShapes:Array.isArray(e.drawn_shapes)?e.drawn_shapes:[]}}).catch(function(e){return console.error("Vertex: Failed to get remote progress",e),{}}).then(function(e){if(j(e))return r;var t=j(r)?0:r.timestamp,n=j(e)?0:e.timestamp;return 0===t&&0===n?{}:t<n?(M(e),e):(R(r),r)})},X=function(e){var t=function(t){try{var e=JSON.parse(window.localStorage.getItem("vertexPackProgress"));return e&&0!==e.length?e.filter(function(e){return e.pack_id===t}).map(function(e){return{id:e.puzzle_id,packId:e.pack_id,puzzleType:e.puzzle_type,timestamp:e.timestamp,isComplete:e.is_complete,drawnLines:Array.isArray(e.drawn_lines)?e.drawn_lines:[],drawnShapes:Array.isArray(e.drawn_shapes)?e.drawn_shapes:[]}}):[]}catch(e){return console.error("Vertex: Failed to get local pack progress:",e),[]}}(e);return e=e,l.xhr.get("".concat(l.env.api,"/svc/vertex/v1/game/pack-progress/").concat(e,".json")).then(function(e){return e.map(function(e){return{id:e.puzzle_id,timestamp:e.timestamp,isComplete:e.is_complete,drawnLines:Array.isArray(e.drawn_lines)?e.drawn_lines:[],drawnShapes:Array.isArray(e.drawn_shapes)?e.drawn_shapes:[]}})}).catch(function(e){return console.error("Vertex: Failed to get remote pack progress",e),[]}).then(function(e){return 0===e.length?t:e})};function B(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function U(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function G(e,t,n){var r;J[e]?(r=function(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?B(Object(n),!0).forEach(function(e){U(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}((U(r={},K,t),U(r,$,n),r),J[e]),Q(r)):console.error(new Error("unrecognized tracking event '".concat(e,"' in:\n").concat(Object.keys(J).join(", "))))}function Y(e){var t;return 2*e<1?(t=2*e,.5*Math.pow(t,3)):(t=e-2,.5*Math.pow(t,3)+2)}function V(){return Date.now()}function H(){var e=document.getElementById("js-hook-concierge"),t=document.getElementById("js-hook-concierge__game"),n=document.getElementById("js-hook-concierge__congrats");return Se(e,t,n),new Promise(function(e){return setTimeout(e,1e3)})}var W="type",q="where",Z="what",K="id",$="extra",J={START_GAME:(U(Jt={},W,"click"),U(Jt,q,"vertex"),U(Jt,Z,"start-game"),Jt),RULES:(U(Kt={},W,"click"),U(Kt,q,"vertex"),U(Kt,Z,"help"),Kt),COMPLETE_20:(U($t={},W,"complete"),U($t,q,"vertex"),U($t,Z,"20%-complete"),$t),COMPLETE_40:(U(Jt={},W,"complete"),U(Jt,q,"vertex"),U(Jt,Z,"40%-complete"),Jt),COMPLETE_60:(U(Kt={},W,"complete"),U(Kt,q,"vertex"),U(Kt,Z,"60%-complete"),Kt),COMPLETE_80:(U($t={},W,"complete"),U($t,q,"vertex"),U($t,Z,"80%-complete"),$t),COMPLETE_100:(U(Jt={},W,"complete"),U(Jt,q,"vertex"),U(Jt,Z,"100%-complete"),Jt),CONTINUE:(U(Kt={},W,"click"),U(Kt,q,"vertex"),U(Kt,Z,"continue"),Kt),NEXT_PUZZLE:(U($t={},W,"click"),U($t,q,"vertex"),U($t,Z,"next-puzzle"),$t),VIEW_SOLVED:(U(Jt={},W,"click"),U(Jt,q,"vertex"),U(Jt,Z,"view-solved"),Jt),ADMIRE_MY_PUZZLE:(U(Kt={},W,"click"),U(Kt,q,"vertex"),U(Kt,Z,"view-my-puzzle"),Kt),BACK_TO_HUB:(U($t={},W,"click"),U($t,q,"vertex"),U($t,Z,"back-to-hub"),$t),RESET:(U(Jt={},W,"click"),U(Jt,q,"vertex"),U(Jt,Z,"reset"),Jt),SKIP_TUTORIAL:(U(Kt={},W,"click"),U(Kt,q,"vertex"),U(Kt,Z,"skip-tutorial"),Kt),SUBSCRIBE:(U($t={},W,"click"),U($t,q,"vertex"),U($t,Z,"subscribe"),$t),LOCKED_PLAY:(U(Jt={},W,"click"),U(Jt,q,"vertex"),U(Jt,Z,"play-subscribe"),Jt)},Q=function(e){e={module:{name:e[W]||"click",context:e[K],label:e[$],element:{name:e[q],label:e[Z]}},eventData:{pageType:"game",type:e[W]||"click",trigger:"module",status:""}};l.track("moduleInteraction",e)},ee="top",te="position",ne="overflow",re="visibility",oe="minHeight",ae="hidden",ie="static",ce="visible",se="relative",le="absolute",ue="on-stage",de="fly-in",me="fly-out",pe="slide-up",he="geo-moment__content",fe="modal-card",ve=400,ge=function(e,t,n){e.style[t]=n},ye=function(e,t){e.classList.add(t)},be=function(e,t){e.length?e.forEach(function(e){e.classList.remove(t)}):e.classList.remove(t)},we=function(a,i,c,e,s){var l=5<arguments.length&&void 0!==arguments[5]?arguments[5]:Y,u=6<arguments.length&&void 0!==arguments[6]?arguments[6]:"px";return new Promise(function(n){var r=e-c,o=V();(function e(){var t=1<=(t=(V()-o)/s)?1:t;a.style[i]=c+l(t)*r+u,1===t?n():window.requestAnimationFrame(e)})()})},Ee=function(e,t){var n=0;e.forEach(function(e){e&&(n+=t,ge(e,"transitionDelay","".concat(n,"ms")),ye(e,pe))})},Se=function(t,n,r){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(){},a=n.offsetHeight,i=document.querySelector(".".concat(fe)),c=document.querySelectorAll(".".concat(pe));ge(t,te,se),ge(t,ne,ae),ge(t,oe,"".concat(a,"px")),ge(r,re,ae),ge(r,te,le),ge(r,ee,0),ye(r,ue),ge(n,te,le),ge(n,ee,0),ye(n,me);var s=r.offsetHeight;C(2*ve).then(function(){c.length&&be(c,pe),ge(r,re,ce),ye(r,de);var e=r.querySelector(".".concat(he));e&&Ee(Array.from(e.children).concat(i),200),o(),we(t,oe,a,s,ve).then(function(){be(n,ue),be(n,me),be(r,de),ge(t,te,ie),ge(t,ne,ce),ge(n,te,ie),ge(r,te,ie),C(100).then(o)})})};function _e(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function ke(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?_e(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):_e(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}var Oe=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document.documentElement,n=Object.entries(window.abra.tests).map(function(e){return e.join("=")}).join(",");return["Hybrid summary:","Platform: ".concat(window.newsreaderAppPlatform?"News App":"XW App"),"Viewport Size: ".concat(t.clientWidth," x ").concat(t.clientHeight),"Logged In: ".concat(e.isLoggedIn?"Yes":"No"),"Xwd: ".concat(e.hasXwd?"Yes":"No"),"Regi: ".concat(e.regiId),"NYTS: ".concat(e.nytsCookie?"Yes":"No"),"Web Version: ".concat(window.env.version),"Flags: ".concat(n)].join("\n")};function Pe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return ze(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ze(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ze(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ce(e){var t=void 0===(i=e.subject)?"":i,n=void 0===(r=e.href)?"":r,r=void 0===(i=e.children)?"":i,o=void 0===(i=e.type)?xe:i,a=void 0===(i=e.user)?{}:i,i=(e=Pe(s.useState("mailto:nytgames@nytimes.com"),2))[0],c=e[1];return s.useEffect(function(){l.getFeedbackLink(t).then(c)},[]),e=n&&t?t:"",i=n?"".concat(n,"?subject=").concat(e):i,P.createElement("a",{rel:"noopener noreferrer",target:"_blank",href:i,onClick:function(e){window.isHybridWebView&&window.NativeBridge&&(e.preventDefault(),window.NativeBridge.gamesSendEmail({type:o,debugInfo:Oe(a)}))}},r)}var xe="feedback";function Ae(){return(Ae=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Te(n){return je.map(function(e){var t=e.name,e=e.Content;return c.createPortal(P.createElement(e,Ae({open:Le.open,close:Le.close},n)),Le.get(t).root)})}var je=[{name:"help",Content:function(){return P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-modal__intro"},P.createElement("div",{className:"geo-modal__title"},"How to play"),P.createElement("div",{className:"geo-modal__description"},"Draw lines between points to create triangles."),P.createElement("ul",{className:"geo-modal__list"},P.createElement("li",null,"Connect vertices to create triangles and assemble an image."),P.createElement("li",null,"The number on a vertex shows its remaining connections."),P.createElement("li",null,"Triangles will fill in if they are correct."),P.createElement("li",null,"Double tap a vertex to clear its connections.")),P.createElement("p",{className:"geo-modal__message"},"There are new puzzles every day."),P.createElement("p",{className:"geo-modal__message"},"Have feedback? Email us at ",P.createElement(Ce,{subject:"Vertex Feedback"},"nytgames@nytimes.com"),".")))},closeByEx:!0,closeByBgClick:!0}],Le=function(e){function r(){}function o(e,t){return e.classList.add(t),e}function t(e,t){return e.classList.remove(t),e}var n,a,i,c,s="pzm",l="".concat(s,"-system"),u="".concat(s,"-modals-wrapper"),d="".concat(s,"-submodal"),m="".concat(s,"-modal"),p="".concat(m,"-content"),h="".concat(m,"-ex"),f="".concat(s,"-active"),v=ke({root:document.body,onOpen:r,onClose:r,modals:[]},e),g={},y=o(v.root,l),b=o(document.createElement("div"),d),w=o(document.createElement("div"),u);w.setAttribute("tabindex","0");function E(e){e.target===w&&x.close()}function S(e){"Escape"===e.key&&(e.preventDefault(),x.close())}function _(e){if(!g[e])throw new Error("unknown modal ".concat(e,"\n\nchoose one of\n\t").concat(Object.keys(g).join("\n\t"),"\n"));return g[e]}function k(e,t,n){var r=C(t),n=n&&C(n);v[e]&&v[e](r,n),t[e]&&t[e](r,n)}function O(e){var t;if(!e.name||g[e.name])throw new Error("modals need a unique name");var n=ke(ke({meta:{},create:r,id:"".concat(s,"-").concat(e.name),className:"",onOpen:r,onClose:r,closeByEx:!0,closeByBgClick:!0,viewTime:0,viewCount:0,subModalContent:void 0},e),{},{root:o(document.createElement("div"),p),wrap:o(document.createElement("div"),m)});n.wrap.setAttribute("id",n.id),n.closeByEx&&(n.ex=o(document.createElement("div"),h),n.ex.innerHTML="×",n.ex.setAttribute("role","button"),n.ex.setAttribute("tabindex","0"),n.ex.addEventListener("click",x.close),n.ex.addEventListener("keydown",function(e){"Enter"!==e.key&&"NumpadEnter"!==e.key||(e.preventDefault(),e.stopPropagation(),x.close())}),n.wrap.appendChild(n.ex)),null!==(t=n.subModalContent)&&void 0!==t&&t.name&&(n.subRoot=o(document.createElement("div"),"".concat(s,"-submodal-content-").concat(e.name)),b.appendChild(n.subRoot),o(n.wrap,"".concat(s,"-with-").concat(n.subModalContent.name))),n.wrap.appendChild(n.root),n.className&&o(n.wrap,n.className),w.appendChild(n.wrap),Object.assign(n,n.create(C(n),x)),g[n.name]=n}function P(e,t){e!==(n&&n.name)&&(e=_(e),a=t,e.viewCount+=1,c=Date.now(),o(e.wrap,f),e.subRoot&&o(e.subRoot,f),w.focus(),e.closeByBgClick&&w.addEventListener("click",E),(e.closeByBgClick||e.closeByEx)&&document.body.addEventListener("keydown",S),k("onOpen",e,n),n=e)}function z(e){n&&(i="string"==typeof e?e:void 0,n.viewTime+=Date.now()-c,t(n.wrap,f),n.subRoot&&t(n.subRoot,f),n.closeByBgClick&&w.removeEventListener("click",E),(n.closeByBgClick||n.closeByEx)&&document.body.removeEventListener("keydown",S),e=n,n=void 0,k("onClose",e))}var C=function(e){return{root:e.root,subRoot:e.subRoot,name:e.name,meta:e.meta,viewTime:e.viewTime,viewCount:e.viewCount,openTrigger:a,closeTrigger:i}},x={add:function(e){O(e)},get:function(e){return C(_(e))},getAll:function(){var t=this;return Object.keys(g).map(function(e){return t.get(e)})},open:function(e,t){n?z():o(y,f),P(e,t)},close:function(){t(y,f),z()},getContent:function(){return w},setScrimColor:function(e){w.style.background=e}};return y.appendChild(w),v.modals.forEach(O),w.appendChild(b),x}({root:document.getElementById("portal-game-modals"),modals:je,onOpen:function(){},onClose:function(){}}),De={tan:"#F7F5F6",black:"#111111",gold:"#E8AE35",gray:"#AAAAAA",red:"#E63333",transparentGold:"rgba(232, 174, 53, 0.1)",transparentBlack:"rgba(17, 17, 17, 0.1)",transparentRed:"rgba(230, 51, 51, 0.1)"},Ne={min:1,max:4},Ie=function(e){var t=P.useRef();return P.useEffect(function(){t.current=e},[e]),t.current};function Me(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function Re(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?Me(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):Me(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function Fe(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:3,o=t?4:5,t=t?2:3;return e<=n?t:r<=e?o:t+=(o-t)*(e/r)}function Xe(){var e=document.getElementById("js-hook-geo-canvas"),t={};document.createEvent?((t=document.createEvent("HTMLEvents")).initEvent("playGame",!0,!0),t.eventName="playGame",e.dispatchEvent(t)):((t=document.createEventObject()).eventName="playGame",t.eventType="playGame",e.fireEvent("on".concat(t.eventType),t))}var Be={zoomedOut:{smallScreen:{smallVertex:{fontSize:8,radius:6,innerStroke:.75,outerStroke:.5,lineDashSegments:[.5,1],tapArea:4},mediumVertex:{fontSize:9,radius:8,innerStroke:.75,outerStroke:.5,lineDashSegments:[.5,1],tapArea:4},largeVertex:{fontSize:10,radius:10,innerStroke:.75,outerStroke:.5,lineDashSegments:[.5,1],tapArea:4}},largerScreen:{smallVertex:{fontSize:10,radius:8,innerStroke:1,outerStroke:.5,lineDashSegments:[.5,1],tapArea:4},mediumVertex:{fontSize:12,radius:11,innerStroke:1,outerStroke:.5,lineDashSegments:[.5,1],tapArea:4},largeVertex:{fontSize:12,radius:14,innerStroke:1,outerStroke:.5,lineDashSegments:[.5,1],tapArea:4}}},zoomedIn:{smallScreen:{smallVertex:{fontSize:10,radius:9,innerStroke:1.5,outerStroke:.75,lineDashSegments:[.75,1],tapArea:6},mediumVertex:{fontSize:14,radius:12,innerStroke:1.5,outerStroke:.75,lineDashSegments:[.75,1],tapArea:6},largeVertex:{fontSize:18,radius:18,innerStroke:1.5,outerStroke:.75,lineDashSegments:[.75,1],tapArea:8}},largerScreen:{smallVertex:{fontSize:14,radius:14,innerStroke:2,outerStroke:1,lineDashSegments:[1,1.5],tapArea:8},mediumVertex:{fontSize:14,radius:18,innerStroke:2,outerStroke:1,lineDashSegments:[1,1.5],tapArea:8},largeVertex:{fontSize:20,radius:24,innerStroke:2,outerStroke:1,lineDashSegments:[1,1.5],tapArea:13}}}},Ue=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:3,o=t.pendingConnections,a=t.shapes,i=t.completedShapes,c=t.preDrawnShapes,t=window.innerWidth<=444?"smallScreen":"largerScreen",o=o<=3?"smallVertex":o<=6?"mediumVertex":"largeVertex",s=Re({},Be.zoomedIn[t][o]),l=Re({},Be.zoomedOut[t][o]),u=e/r;return i.length+c.length===a.length&&(l.radius=0,l.tapArea=0,s.radius=0,s.tapArea=0),e<=n?l:r<=e?s:(Object.keys(l).forEach(function(n){var e;"number"==typeof l[n]&&(e=(s[n]-l[n])*u,l[n]+=e),Array.isArray(l[n])&&l[n].forEach(function(e,t){e=(s[n][t]-e)*u;l[n][t]+=e})}),l)},Ge=function(e){var n,r,o,a;return e.forEach(function(e){var t=e.coords,e=t[0],t=t[1];(!n||e<n)&&(n=e),(!r||r<e)&&(r=e),(!o||t<o)&&(o=t),(!a||a<t)&&(a=t)}),{minX:n,maxX:r,minY:o,maxY:a}};function Ye(e){return function(e){if(Array.isArray(e))return We(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||He(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ve(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||He(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(e,t){if(e){if("string"==typeof e)return We(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?We(e,t):void 0}}function We(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var qe=2*Math.PI,Ze=window.devicePixelRatio,Ke=function(u,e,o){var d=document.createElement("canvas"),m=d.getContext("2d"),p=document.createElement("canvas"),h=p.getContext("2d"),f=document.createElement("canvas"),l=f.getContext("2d"),v=document.createElement("canvas"),g=v.getContext("2d"),t=e.width/2,n=e.height/2-145,r=e.width,a=e.height,i=e.isMobile,e=e.artEdges,y=Object.create({},{zoom:S("_zoom",1),focusX:S("_focus_x",t),focusY:S("_focus_y",n),minFocusX:S("_min_focus_x",e.minX),maxFocusX:S("_max_focus_x",e.maxX),minFocusY:S("_min_focus_y",e.minY),maxFocusY:S("_max_focus_y",e.maxY),artWidth:S("_art_w",r),artHeight:S("_art_h",a),isMobile:S("_isMobile",i),canvasWidth:S("_canvas_w",r),canvasHeight:S("_canvas_h",a),hover:{writable:!0,configurable:!0,value:null},selected:{writable:!0,configurable:!0,value:null},cleared:{writable:!0,configurable:!0,value:null},isAnimating:{writable:!0,configurable:!0,value:null},handleResize:{value:function(){var e=d.getBoundingClientRect(),t=e.width*Ze,n=e.height*Ze;d.setAttribute("width",t),d.setAttribute("height",n),p.setAttribute("width",t),p.setAttribute("height",n),f.setAttribute("width",t),f.setAttribute("height",n),v.setAttribute("width",t),v.setAttribute("height",n),this.top=e.top,this.left=e.left,this.canvasWidth=t,this.canvasHeight=n}},handlePinchStart:{value:function(e){var t;e.preventDefault(),this.isMobile?e.touches&&(t=function(e){var t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};for(var n=0,r=0,o=0;o<t;)n+=e[o].clientX,r+=e[o].clientY,o+=1;return{x:Math.round(n/t),y:Math.round(r/t)}}(e.touches)):t={x:e.clientX,y:e.clientY},this._initialFocus={x:this.focusX,y:this.focusY},this._initialZoom=this.zoom,t&&void 0!==t.x&&void 0!==t.y&&(this.clientX=t.x,this.clientY=t.y)}},handlePinch:{value:function(e){e.preventDefault();var t=this._scaleAdjustment;void 0!==this._initialFocus&&null!==this._initialFocus||(this._initialFocus={x:this.focusX,y:this.focusY},this._initialZoom=this.zoom);var n=this._initialFocus.x-e.deltaX/t*Ze,t=this._initialFocus.y-e.deltaY/t*Ze;this.setZoom(e.scale),n>=this.maxFocusX?this.focusX=this.maxFocusX:n<=this.minFocusX?this.focusX=this.minFocusX:this.focusX=n,t>=this.maxFocusY?this.focusY=this.maxFocusY:t<=this.minFocusY?this.focusY=this.minFocusY:this.focusY=t}},handleTouchStart:{value:function(e){e.preventDefault();var t=this.isUserTouchingPoint(e);t?_(e)||(this.selected=t.id,(t=this.points[t.id]).animate(2*t.tapArea,!0).start()):this.handlePinchStart(e)}},handleTouchMove:{value:function(e){var t,n;e.preventDefault(),this.isTapping=!1,_(e)||((t=this.points[this.selected])||void 0===this._initialFocus||null===this._initialFocus||this.setFocus(e),t&&0!==t.pendingConnections&&(n=this.getAdjustedMousePosition(e),this.handleHover(e),this.drawCurrentLine(t.coords,this.toArtPoint(n))))}},handleTouchEnd:{value:function(e){var t,n,r;e.preventDefault(),this.isTapping?this.isTapping=!1:(this.cleared=null)!==this.selected&&(t=this.points[this.selected],(n=this.isUserTouchingPoint(e,!0))&&t.id!==n.id&&0<t.pendingConnections&&0<n.pendingConnections&&!E(t.coords,n.coords,this.lines)?(this.clearCurrentLineCanvas(),o.drawLine([t.id,n.id]),r=Ue(y.zoom,t).tapArea,t.animate(r).start()):(r=t.animate(t.tapArea/2),e=this.getAdjustedMousePosition(e),e=this.reelInCurrentLine(y.toArtPoint(e)),0!==t.pendingConnections&&r.chain(e),r.start()),this.isMobile&&(this.hover=null),this.selected=null,y.drawPoints())}},handleDoubleTap:{value:function(e){if(!this.isAnimating){if(null!==this.selected)t=this.points[this.selected];else{if(null===(t=this.isUserTouchingPoint(e)))return;this.selected=t.id}o.clearConnections(this.selected);var t=Ue(y.zoom,t).tapArea;this.points[this.selected].animate(t,!1,function(){y.selected=null}).start(),g.clearRect(0,0,y.canvasWidth,y.canvasHeight)}}},handleHover:{value:function(e){e.preventDefault();var t=this.isUserTouchingPoint(e,!0),n=null===t&&null===this.hover,e=t&&t.id===this.hover;n||e||(this.hover=t?t.id:null,y.drawPoints())}},getAdjustedMousePosition:{value:function(e){e.preventDefault();e=e.srcEvent||e,e=e.changedTouches?e.changedTouches[0]:e;return[(e.clientX-this.left)*Ze,(e.clientY-this.top)*Ze]}},isUserTouchingPoint:{value:function(e){var r=this,t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],e=Ve(this.getAdjustedMousePosition(e),2),o=e[0],a=e[1],i=1/0,c=null,s=t?3:2;return this.points.forEach(function(e){var t=Ve(r.toCanvasPoint(e.coords),2),n=t[0],t=t[1],t=Math.sqrt(Math.pow(o-n,2)+Math.pow(a-t,2));t<=(e.radius+e.tapArea)*Ze*s&&t<i&&(i=t,c=e)}),c}},setup:{value:function(){var t=this;u.style.position="relative",d.style.position="absolute",d.style.top=0,d.style.left=0,d.style.width="100%",d.style.height="100%",p.style.position="absolute",p.style.top=0,p.style.left=0,p.style.width="100%",p.style.height="100%",f.style.position="absolute",f.style.top=0,f.style.left=0,f.style.width="100%",f.style.height="100%",v.style.position="absolute",v.style.top=0,v.style.left=0,v.style.width="100%",v.style.height="100%";function e(e){return t.handleResize(e)}function n(e){y.isDrawing=!0,a(e)}function r(e){(y.isDrawing?i:s)(e)}function o(e){y.isDrawing=!1,c(e)}var a=function(e){return t.handleTouchStart(e)},i=function(e){return t.handleTouchMove(e)},c=function(e){return t.handleTouchEnd(e)},s=function(e){return t.handleHover(e)},l=new b.Manager(u,{recognizers:[[b.Press,{enable:!1}],[b.Pinch,{enable:!0,pointers:2}],[b.Tap,{enable:!0,pointers:1,taps:2}],[b.Pan,{enable:!1}],[b.Swipe,{enable:!1}]]});window.addEventListener("playGame",e),window.addEventListener("resize",e),l.on("tap",function(e){t.isTapping=!0,t.handleDoubleTap(e)}),this.isMobile?(d.addEventListener("touchstart",a),d.addEventListener("touchmove",i),d.addEventListener("touchend",c),l.on("pinchstart",function(e){return t.handlePinchStart(e)}),l.on("pinchmove",function(e){return t.handlePinch(e)})):(window.addEventListener("scroll",e),d.addEventListener("mousedown",n),d.addEventListener("mousemove",r),d.addEventListener("mouseup",o)),u.appendChild(p),u.appendChild(f),u.appendChild(v),u.appendChild(d),e(),this.destroy=function(){t.requestedFrame&&window.cancelAnimationFrame(t._requestedFrame),window.removeEventListener("resize",e),window.removeEventListener("scroll",e),d.removeEventListener("touchstart",a),d.removeEventListener("touchmove",i),d.removeEventListener("touchend",c),d.removeEventListener("mousedown",n),d.removeEventListener("mousemove",r),d.removeEventListener("mouseup",o),l.destroy(),d.remove(),f.remove(),p.remove(),v.remove()}}},update:{value:function(){var e=this.zoom,t=this.focusX,n=this.focusY,r=this.artWidth,o=this.artHeight,a=this.canvasWidth,i=this.canvasHeight,c=(a/i<r/o?a/r:i/o)*e,s=(r/2-t)*c+(a-r*c)/2,l=(o/2-n)*c+(i-o*c)/2;this.toArtPoint=function(e){var t=Ve(e,2),e=t[0],t=t[1];return[Math.round((e-s)/c),Math.round((t-l)/c)]},this.toCanvasPoint=function(e){var t=Ve(e,2),e=t[0],t=t[1];return[Math.round(e*c+s),Math.round(t*c+l)]},this._scaleAdjustment=c,this.points.forEach(function(e){var t=Ue(y.zoom,e),n=t.fontSize,r=t.radius,o=t.innerStroke,a=t.outerStroke,i=t.lineDashSegments,t=t.tapArea;e.fontSize=n,e.radius=e.overrides.radius||r,e.innerStroke=o,e.outerStroke=a,e.lineDashSegments=i,e.tapArea=e.overrides.tapArea||t}),y.redrawAll()}},setFocus:{value:function(e){var t,n;void 0===this.clientX||Object.is(this.clientX,NaN)||void 0===this.clientY||Object.is(this.clientY,NaN)||(n=this._scaleAdjustment,t=e.changedTouches?e.changedTouches[0].clientX-this.clientX:e.clientX-this.clientX,e=e.changedTouches?e.changedTouches[0].clientY-this.clientY:e.clientY-this.clientY,t=this._initialFocus.x-t/n*Ze,n=this._initialFocus.y-e/n*Ze,t>=this.maxFocusX?this.focusX=this.maxFocusX:t<=this.minFocusX?this.focusX=this.minFocusX:this.focusX=t,n>=this.maxFocusY?this.focusY=this.maxFocusY:n<=this.minFocusY?this.focusY=this.minFocusY:this.focusY=n)}},setZoom:{value:function(e){e=this.isMobile?this._initialZoom*e:"in"===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"in")?this.zoom*e:this.zoom/e;return e<=Ne.min?this.zoom=Ne.min:e>=Ne.max?this.zoom=Ne.max:this.zoom=e,this.zoom}},zoomOutAnimation:{value:function(){var t=this,e=this.artWidth/2,n=this.artHeight/2-145,r={z:this.zoom,x:this.focusX,y:this.focusY};return new w.Tween(r).to({z:Ne.min,x:e,y:n},500).onUpdate(function(e){t.zoom=e.z,t.focusX=e.x,t.focusY=e.y,y.redrawAll()})}},points:{value:[]},lines:{value:[]},triangles:{value:[]},drawCurrentLine:{value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];y.clearCurrentLineCanvas();var r=null!==y.hover&&y.hover!==y.selected,o=Ve(y.toCanvasPoint(e),2),a=o[0],i=o[1],e=Ve(y.toCanvasPoint(t),2),o=e[0],t=e[1],e=Fe(y.zoom,y.isMobile);g.beginPath(),g.strokeStyle=n?De.red:r?De.gold:De.black,g.lineWidth=e*Ze,g.moveTo(a,i),g.lineTo(o,t),g.setLineDash([e*Ze,e*Ze]),g.stroke(),null!==y.selected&&(e=y.points[y.selected],g.beginPath(),g.arc(o,t,4*Ze,0,qe,!1),g.fillStyle=n?De.red:r?De.gold:De.black,g.fill(),g.beginPath(),g.lineWidth=e.outerStroke*Ze,g.strokeStyle=De.black,g.arc(o,t,(e.radius+e.tapArea)*Ze,0,qe,!1),g.setLineDash([e.lineDashSegments[0]*Ze,e.lineDashSegments[1]*Ze]),g.stroke())}},reelInCurrentLine:{value:function(e){var t=y.points[y.selected],e=Ye(e),n=Ye(t.coords);return new w.Tween(e).to(n,200).onUpdate(function(e){y.drawCurrentLine(n,e,!0)}).easing(w.Easing.Exponential.InOut).onComplete(function(){y.clearCurrentLineCanvas(),y.selected=null})}},addPoint:{value:function(e){var t=e.coords,u=e.id,n=e.pendingConnections,r=e.shapes,o=e.completedShapes,a=e.preDrawnShapes,i=Ue(y.zoom,e),c=i.radius,s=i.fontSize,d=i.innerStroke,l=i.outerStroke,e=i.lineDashSegments,i=i.tapArea;y.points.push({id:u,coords:t,pendingConnections:n,radius:c,fontSize:s,innerStroke:d,outerStroke:l,lineDashSegments:e,tapArea:i,shapes:r,completedShapes:o,preDrawnShapes:a,overrides:{radius:null,fontSize:null,innerStroke:null,outerStroke:null,lineDashSegments:null,tapArea:null},draw:function(){var e,t,n,r,o,a,i,c,s,l;0!==this.radius&&(e=(l=Ve(y.toCanvasPoint(this.coords),2))[0],t=l[1],n="600 ".concat(this.fontSize*Ze,"px nyt-franklin"),r=u,o=y.selected,a=y.hover,i=y.cleared,c=null!==o&&r!==o&&r===a,s=r===o&&null!==a&&a!==r,l=i&&r===i.id,i={innerFillStyle:De.tan,outerFillStyle:"transparent",innerStrokeStyle:De.black,outerStrokeStyle:De.black,fontColor:De.black},(r===o||null===o&&r===a)&&(i.innerFillStyle=De.black,i.outerFillStyle=De.transparentBlack,i.fontColor=De.tan),(c||s)&&(i.innerFillStyle=De.gold,i.innerStrokeStyle=De.gold,i.outerStrokeStyle=De.gold,i.outerFillStyle=De.transparentGold,i.fontColor=De.black),l&&(i.innerFillStyle=De.red,i.innerStrokeStyle=De.red,i.outerStrokeStyle=De.red,i.outerFillStyle=De.transparentRed,i.fontColor=De.tan),a=i.innerFillStyle,c=i.outerFillStyle,s=i.innerStrokeStyle,l=i.outerStrokeStyle,i=i.fontColor,m.beginPath(),m.lineWidth=d*Ze,m.textAlign="center",m.textBaseline="middle",m.font=n,m.arc(e,t,this.radius*Ze,0,qe,!1),m.fillStyle=a,m.strokeStyle=s,m.fill(),m.setLineDash([]),m.stroke(),m.beginPath(),m.arc(e,t,(this.radius+this.tapArea)*Ze,0,qe,!1),m.lineWidth=this.outerStroke*Ze,m.strokeStyle=l,m.fillStyle=c,m.setLineDash([this.lineDashSegments[0]*Ze,this.lineDashSegments[1]*Ze]),m.fill(),m.stroke(),m.setLineDash([]),m.fillStyle=i,m.fillText(this.pendingConnections.toString(),e,t))},animate:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]&&arguments[1],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){},o={t:this.tapArea};return new w.Tween(o).to({t:e},100).onUpdate(function(e){t.tapArea=e.t,t.overrides.tapArea=e.t,y.drawPoints()}).onComplete(function(){n?t.overrides.tapArea=e:(t.tapArea=Ue(y.zoom,t).tapArea,t.overrides.tapArea=null),r(),y.drawPoints()})},animateShrink:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o={r:this.radius,t:this.tapArea};return new w.Tween(o).to({r:e,t:t},100).onUpdate(function(e){n.radius=e.r,n.tapArea=e.t,n.overrides.radius=e.r,n.overrides.tapArea=e.t,y.drawPoints()}).onComplete(function(){r?n.overrides.radius=e:(n.radius=Ue(y.zoom,n).tapArea,n.overrides.radius=null),y.drawPoints()})}})}},addLine:{value:function(t,n){var c=2<arguments.length&&void 0!==arguments[2]&&arguments[2],s=3<arguments.length&&void 0!==arguments[3]&&arguments[3];if(!this.lines.includes(function(e){return e.a===t&&e.b===n}))return this.lines.push({a:t,b:n,draw:function(){var e=null!==y.hover&&c&&y.hover!==y.selected,t=Ve(y.toCanvasPoint(this.a),2),n=t[0],r=t[1],o=Ve(y.toCanvasPoint(this.b),2),a=o[0],i=o[1],t=Fe(y.zoom,y.isMobile),o=c?g:l;o.beginPath(),o.strokeStyle=s?De.red:e?De.gold:De.black,o.lineWidth=c||s?t*Ze:Ze,o.moveTo(n,r),o.lineTo(a,i),c||s?o.setLineDash([t*Ze,t*Ze]):o.setLineDash([]),o.stroke(),c&&this.drawEndPoint(a,i)},drawEndPoint:function(e,t){var n,r;null!==y.selected&&(r=null!==(n=y.points[y.selected])&&null!==y.hover&&n.id!==y.hover,g.beginPath(),g.arc(e,t,4*Ze,0,qe,!1),g.fillStyle=r?De.gold:De.black,g.fill(),g.beginPath(),g.lineWidth=n.outerStroke*Ze,g.strokeStyle=De.black,g.arc(e,t,(n.radius+n.tapArea)*Ze,0,qe,!1),g.setLineDash([n.lineDashSegments[0]*Ze,n.lineDashSegments[1]*Ze]),g.stroke())},reelIn:function(){var t=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0],r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:function(){};y.cleared=2<arguments.length?arguments[2]:void 0,this.isAnimating=!0;var e=Ye(n?this.a:this.b),o=Ye(n?this.b:this.a);return new w.Tween(e).to(o,200).onUpdate(function(e){n?t.a=e:t.b=e,r()}).easing(w.Easing.Exponential.InOut).onComplete(function(){y.cleared=null,r(),t.isAnimating=!1})}}),this.lines[this.lines.length-1]}},animateLine:{value:function(e,t){var n=this;this.addLine(e.coords,e.coords);var r=this.lines.length-1;new w.Tween(Ye(e.coords)).to(Ye(t.coords),1e3).onUpdate(function(e){n.lines[r].b=e}).start()}},addTriangle:{value:function(i,c,s){var l=this,u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"#00F",e=4<arguments.length?arguments[4]:void 0,n=5<arguments.length?arguments[5]:void 0,r=6<arguments.length&&void 0!==arguments[6]&&arguments[6];return e.forEach(function(e){var t=l.points[e];r||t.completedShapes.push(n),t.completedShapes.length+t.preDrawnShapes.length===l.points[e].shapes.length&&l.points[e].animateShrink(0,0).start()}),this.triangles.push({draw:function(){var e=Ve(l.toCanvasPoint(i),2),t=e[0],n=e[1],r=Ve(l.toCanvasPoint(c),2),o=r[0],a=r[1],e=Ve(l.toCanvasPoint(s),2),r=e[0],e=e[1];h.fillStyle=u,h.strokeStyle=u,h.beginPath(),h.moveTo(t,n),h.lineTo(o,a),h.lineTo(r,e),h.lineTo(t,n),h.closePath(),h.fill(),h.stroke()}}),this.triangles[this.triangles.length-1]}},removeLine:{value:function(r){var o=this,e=this.lines.findIndex(function(e){var t=o.points[r[0]].coords,n=o.points[r[1]].coords;return e.a.toString()===t.toString()&&e.b.toString()===n.toString()});this.lines.splice(e,1)}},resetLines:{value:function(){this.lines.length=0}},resetTriangles:{value:function(){this.triangles.length=0}},clearCurrentLineCanvas:{value:function(){g.clearRect(0,0,y.canvasWidth,y.canvasHeight)}},redrawAll:{value:function(){g.clearRect(0,0,y.canvasWidth,y.canvasHeight),h.clearRect(0,0,y.canvasWidth,y.canvasHeight),l.clearRect(0,0,y.canvasWidth,y.canvasHeight),m.clearRect(0,0,y.canvasWidth,y.canvasHeight),y.triangles.forEach(function(e){return e.draw()}),y.lines.forEach(function(e){return e.draw()}),y.points.forEach(function(e){return e.draw()})}},drawLines:{value:function(){l.clearRect(0,0,y.canvasWidth,y.canvasHeight),y.lines.forEach(function(e){return e.draw()})}},drawPoints:{value:function(){m.clearRect(0,0,y.canvasWidth,y.canvasHeight),y.points.forEach(function(e){return e.draw()})}},drawTriangles:{value:function(){h.clearRect(0,0,y.canvasWidth,y.canvasHeight),y.triangles.forEach(function(e){return e.draw()})}}});return y.setup(),function e(t){w.update(t),y.requestedFrame=window.requestAnimationFrame(e)}(),y};function $e(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Je(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qe(e){var t=e.puzzleState,n=e.isMobile,r=e.actions,o=e.track,a=t.id,i=t.shapes,c=t.vertices,s=t.isComplete,l=t.puzzleType,u=t.drawnLines,d=t.drawnShapes,m=t.preDrawnLines,p=t.preDrawnShapes,h=t.tutorialPuzzles,f=t.pendingConnections,v=n?"calc(100vh - 46px)":"100vh",g=Object.values(c),y=P.useRef(),b=P.useRef(),w=Ie(u)||[],E=Ie(d)||[],S=(e=$e(P.useState(Ne.min),2))[0],_=e[1];return P.useEffect(function(){var e={width:800,height:1400,isMobile:n,artEdges:Ge(g)},e=Ke(y.current,e,r);return b.current=e,g.forEach(function(e){b.current.addPoint(e)}),m.forEach(function(e){b.current.addLine(c[e[0]].coords,c[e[1]].coords)}),p.forEach(function(e){b.current.addTriangle(c[e.vertices[0]].coords,c[e.vertices[1]].coords,c[e.vertices[2]].coords,e.color,e.vertices,e.id,!0)}),b.current.drawLines(),e.destroy},[c]),P.useEffect(function(){if(u.length>w.length)u.slice(w.length).forEach(function(e){b.current.addLine(c[e[0]].coords,c[e[1]].coords).draw()});else{var e,r,o,a,t;if(2<w.length&&0===u.length&&!b.current.cleared)return b.current.resetLines(),m.forEach(function(e){b.current.addLine(c[e[0]].coords,c[e[1]].coords)}),b.current.drawLines(),b.current.selected=null,void b.current.clearCurrentLineCanvas();u.length<w.length&&(e=w.filter(function(e){return!x(e,u.concat(m))}),null!==b.current.selected&&(r=b.current.points[b.current.selected],o=r.coords[0],a=r.coords[1],e.forEach(function(e){var t=b.current.addLine(b.current.points[e[0]].coords,b.current.points[e[1]].coords,!1,!0),n=o===t.b[0]&&a===t.b[1];b.current.removeLine(e),t.reelIn(n,b.current.drawLines,r).start()})),null===b.current.selected&&0<e.length&&(t=e[0],t=b.current.addLine(b.current.points[t[0]].coords,b.current.points[t[1]].coords,!1,!0),b.current.removeLine(e[0]),t.reelIn(!1,b.current.drawLines).start()),C(200).then(function(){b.current.resetLines(),m.forEach(function(e){b.current.addLine(c[e[0]].coords,c[e[1]].coords)}),u.forEach(function(e){return b.current.addLine(b.current.points[e[0]].coords,b.current.points[e[1]].coords)}),b.current.drawLines(),b.current.cleared=null,b.current.drawPoints()}))}},[u]),P.useEffect(function(){d.length<E.length&&(b.current.points.forEach(function(e){e.completedShapes=[];var t=Ue(b.current.zoom,e),n=t.radius,t=t.tapArea;e.radius=n,e.tapArea=t}),b.current.resetTriangles(),p.forEach(function(e){b.current.addTriangle(c[e.vertices[0]].coords,c[e.vertices[1]].coords,c[e.vertices[2]].coords,e.color,e.vertices,e.id,!0)}),b.current.drawTriangles()),d.slice(E.length).forEach(function(e){b.current.addTriangle(b.current.points[i[e].vertices[0]].coords,b.current.points[i[e].vertices[1]].coords,b.current.points[i[e].vertices[2]].coords,i[e].color,i[e].vertices,i[e].id).draw()}),function(e,t,n){e=e.length/Object.keys(n).length*100,n=t.length/Object.keys(n).length*100;e<100&&100==n?o("COMPLETE_100"):e<80&&80<=n?o("COMPLETE_80"):e<60&&60<=n?o("COMPLETE_60"):e<40&&40<=n?o("COMPLETE_40"):e<20&&20<=n&&o("COMPLETE_20")}(E,d,i)},[d]),P.useEffect(function(){b.current.points.forEach(function(e){var t,n,r,o,a,i;f[e.id]!==e.pendingConnections&&(e.pendingConnections=f[e.id],t=(i=Ue(b.current.zoom,e)).fontSize,n=i.radius,r=i.innerStroke,o=i.outerStroke,a=i.lineDashSegments,i=i.tapArea,e.fontSize=t,e.radius=e.overrides.radius||n,e.innerStroke=r,e.outerStroke=o,e.lineDashSegments=a,e.tapArea=e.overrides.tapArea||i)}),b.current.drawPoints()},[f]),P.useEffect(function(){s&&(b.current.zoomOutAnimation().start(),_(b.current.zoom),"tutorial"===l&&!A(a,h)||b.current.resetLines())},[s]),t=function(){return P.createElement("button",{type:"button",className:"geo-undo",onClick:r.undoLine},P.createElement("p",null,"Undo"))},e=function(){return P.createElement("div",{className:"geo-zoom-panel"},P.createElement("button",{type:"button",className:O({disabled:S===Ne.max}),onClick:function(){_(b.current.setZoom(1.25))}},P.createElement("p",null,"+")),P.createElement("button",{type:"button",className:O({disabled:S===Ne.min}),onClick:function(){_(b.current.setZoom(1.25,"out"))}},P.createElement("p",null,"–")))},P.createElement("div",null,P.createElement("div",{ref:y,className:"geo-canvas",id:"js-hook-geo-canvas",style:{width:"100vw",height:v,background:"".concat(De.tan),position:"relative"}}),P.createElement(t,null),!n&&P.createElement(e,null))}function et(e){return e=e.shapeCount,P.createElement("div",{className:"geo-shape-counter"},P.createElement("p",null,e))}var tt=["timestamp"];function nt(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),a=0;a<o.length;a++)n=o[a],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function rt(e){return function(e){if(Array.isArray(e))return ot(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ot(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ot(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ot(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function at(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function it(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?at(Object(n),!0).forEach(function(e){ct(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):at(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function ct(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function st(t,e){switch(e.type){case"DRAW_LINE":return it(it({},t),{},{pendingConnections:it(it({},t.pendingConnections),{},(ct(n={},e.line[0],t.pendingConnections[e.line[0]]-1),ct(n,e.line[1],t.pendingConnections[e.line[1]]-1),n)),drawnLines:[].concat(rt(t.drawnLines),[e.line])});case"DRAW_SHAPE":var n;return it(it({},t),{},{pendingConnections:it(it({},t.pendingConnections),{},(ct(n={},e.line[0],t.pendingConnections[e.line[0]]-1),ct(n,e.line[1],t.pendingConnections[e.line[1]]-1),n)),drawnShapes:[].concat(rt(t.drawnShapes),rt(e.newShapeIds)),drawnLines:[].concat(rt(t.drawnLines),[e.line])});case"COMPLETE_GAME":return it(it({},t),{},{isComplete:!0,pendingConnections:it(it({},t.pendingConnections),{},(ct(r={},e.line[0],t.pendingConnections[e.line[0]]-1),ct(r,e.line[1],t.pendingConnections[e.line[1]]-1),r)),drawnShapes:[].concat(rt(t.drawnShapes),rt(e.newShapeIds)),drawnLines:[].concat(rt(t.drawnLines),[e.line])});case"CLEAR_CONNECTIONS":var r=h(e.vertexId,t),o=r.drawnLines,r=r.otherVertices;return it(it({},t),{},{pendingConnections:it(it({},t.pendingConnections),f(t,r,e.vertexId)),drawnLines:o});case"UNDO_CONNECTION":var a=rt(t.drawnLines),o=a.splice(e.idx,1)[0];return it(it({},t),{},{pendingConnections:it(it({},t.pendingConnections),f(t,[o[0]],o[1])),drawnLines:a});case"RESET_GAME":var i=it({},t.pendingConnections);return Object.keys(i).forEach(function(e){i[e]=p(t.shapes,e,t.preDrawnLines)}),it(it({},t),{},{isComplete:!1,pendingConnections:i,drawnLines:[],drawnShapes:[]});case"DEBUG_COMPLETE_GAME":return it(it({},t),{},{isComplete:!0,drawnShapes:rt(Object.keys(t.shapes).map(function(e){return parseInt(e)}))});case"SET_CURRENT_PUZZLE":a=e.progress,a=(a.timestamp,nt(a,tt));return it(it(it(it({},t),e.puzzle),a),{},{pendingConnections:v(e.puzzle,e.progress)});case"COMPLETE_TUTORIAL":return it(it({},t),{},{hasCompletedTutorial:!0});case"COMPLETE_STARTER_PACK":return it(it({},t),{},{hasCompletedTutorial:!0,hasCompletedStarterPack:!0});default:return t}}function lt(e,t){var n=e.id,r=e.vertices,o=e.shapes,a=e.palette,i=void 0===(s=e.preDrawnLines)?[]:s,c=Object.keys(r),s=Object.keys(o),l={id:n,puzzleType:t,packId:t,shapes:{},vertices:{},theme:e.theme,displayDate:e.displayDate,puzzleConstructor:e.puzzleConstructor,preDrawnShapes:[],preDrawnLines:i.map(function(e){return e.sort(function(e,t){return e-t})}),drawnLines:[],drawnShapes:[],pendingConnections:{},isComplete:!1};return s.forEach(function(e){var t=o[e];if(t.isPreDrawn)return l.preDrawnShapes.push({id:parseInt(e),vertices:t.vertices.sort(function(e,t){return e-t}),color:a[t.color]}),l.preDrawnLines.push([t.vertices[0],t.vertices[1]]),l.preDrawnLines.push([t.vertices[0],t.vertices[2]]),void l.preDrawnLines.push([t.vertices[1],t.vertices[2]]);l.shapes[e]={id:parseInt(e),vertices:t.vertices.sort(function(e,t){return e-t}),lines:[[t.vertices[0],t.vertices[1]],[t.vertices[0],t.vertices[2]],[t.vertices[1],t.vertices[2]]],color:a[t.color]}}),c.forEach(function(e){l.vertices[e]={id:parseInt(e),coords:r[e].coordinates,shapes:r[e].shapes,completedShapes:[],preDrawnShapes:[]},l.pendingConnections[e]=p(l.shapes,e,l.preDrawnLines)}),l.preDrawnShapes.forEach(function(t){Object.values(l.vertices).forEach(function(e){t.vertices.includes(e.id)&&l.vertices[e.id].preDrawnShapes.push(t.id)})}),l}var ut=["tutorial","starterPuzzles"];function dt(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function mt(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?dt(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):dt(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}function pt(e,t){if(null==e)return{};var n,r=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(e),a=0;a<o.length;a++)n=o[a],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n]);return r}function ht(e){return function(e){if(Array.isArray(e))return ft(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ft(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vt(e){return{type:"SET_CURRENT_PUZZLE",puzzle:e,progress:1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}}}function gt(o){return function(r){return function(e){var t=r(e),n=o.getState();return"tutorial"!==n.puzzleType&&"COMPLETE_TUTORIAL"!==e&&"COMPLETE_STARTER_PACK"!==e&&M(n),t}}}function yt(e){var n=e.resetGame,r=e.debugCompleteGame,o=e.skipTutorial,a=e.openRulesModal,i=k.useUser().userType;return P.useEffect(function(){var e=[{type:"text",value:"Debug Complete",action:r}],t=[{type:"text",value:"Help",action:a},{type:"text",value:"Reset",action:n}];o&&t.push({type:"text",value:"Skip",action:o}),l.mobileNavTools.create(i.inShortzMode?[].concat(t,e):t)},[n,r,i]),e=i.inShortzMode||"prod"!==l.env.name,c.createPortal(P.createElement(P.Fragment,null,P.createElement("span",{className:"pz-toolbar-left"},e&&P.createElement("span",{role:"button",className:"pz-toolbar-button",onClick:r},"Debug Complete"),o&&P.createElement("span",{role:"button",className:"pz-toolbar-button",onClick:o},"Skip Tutorial")),P.createElement("span",{className:"pz-toolbar-right"},P.createElement("span",{role:"button",className:"pz-toolbar-button",onClick:a},"Help"),P.createElement("span",{role:"button",className:"pz-toolbar-button",onClick:n},"Reset"))),At)}function bt(e){var t=e.icon,e=e.size;return P.createElement("div",{className:O("pz-moment__icon",void 0===e?"large":e,t)})}function wt(e){var t=e.text,e=e.size;return P.createElement("h1",{className:O("pz-moment__title",void 0===e?"large":e)},t)}function Et(e){var t=e.text,e=e.variant;return P.createElement("h1",{className:O("pz-moment__description",void 0===e?"default":e),dangerouslySetInnerHTML:{__html:t}})}function St(e){return e=e.children,P.createElement("div",{className:"pz-moment__body"},e)}function _t(e){var t=e.action,n=e.text,r=e.color,o=e.variant,e=e.icon;return P.createElement("button",{type:"button",className:O("pz-moment__button",void 0===r?"primary":r,o),onClick:t},n,"locked"===e&&P.createElement("div",{className:"pz-moment__button--padlock"}))}function kt(e){var t=e.userType,n=e.hasCompletedDailyPuzzle,r=e.hasProgress,o=e.toSubLandingPage,a=e.playGame,i=e.track;return t.hasXwd?n?P.createElement(_t,{text:"Solved",action:function(){a(),i("VIEW_SOLVED")}}):P.createElement(_t,{action:r?function(){a(),i("CONTINUE")}:function(){a(),i("START_GAME")},text:r?"Continue":"Today's Puzzle"}):P.createElement(P.Fragment,null,P.createElement(_t,{text:"Subscribe",action:function(){o("vertexWelcomeMomentDailyPuzzle"),i("SUBSCRIBE")}}),P.createElement(_t,{action:function(){o("vertexTodaysPuzzle"),i("LOCKED_PLAY")},text:"Today’s Puzzle",icon:"locked",color:"secondary"}))}function Ot(e){var t=e.hasProgress,n=e.hasCompletedDailyPuzzle,r=e.hasLoaded;return(e=e.userType).hasXwd?t?n?P.createElement(Et,{text:"Come back tomorrow to play a new puzzle."}):P.createElement(Et,{text:"Reveal the full picture."}):P.createElement(Et,{text:"Connect the dots and <br/> reveal the hidden picture."}):r&&!e.hasXwd?P.createElement(Et,{text:"Subscribe to New York Times Games to play Vertex every day."}):null}function Pt(e){var t=e.hasCompletedTutorial,n=e.hasCompletedStarterPack;return t?t&&!n?P.createElement(Lt,e):P.createElement(Tt,e):P.createElement(jt,e)}function zt(e){var t=e.header,n=e.title,r=e.text,o=e.containerClassNames,a=e.link,i=e.clickHandler,e=e.fontColor;return P.createElement("a",{href:a,onClick:i,className:O("modal-card",o)},P.createElement("div",{className:"modal-card__header",style:{color:e||"#000"}},t),P.createElement("div",{className:"modal-card__inset"},P.createElement("div",{className:"modal-card__icon"}),P.createElement("div",{className:"modal-card__info"},P.createElement("div",{className:"modal-card__title"},n),P.createElement("div",{dangerouslySetInnerHTML:{__html:r},className:"modal-card__text"})),P.createElement("div",{className:"modal-card__arrow"})))}var Ct={id:"1",theme:"",packId:"",shapes:{},palette:[],vertices:{},puzzleType:"",displayDate:"",drawnLines:[],drawnShapes:[],isComplete:!1,preDrawnLines:[],preDrawnShapes:[],puzzleConstructor:"",pendingConnections:[],dailyPuzzle:{},tutorialPuzzles:[],starterPackPuzzles:[],hasCompletedTutorial:!1,hasCompletedStarterPack:!1},xt=e.connect(function(e){return{state:e}},{drawLine:function(s){return function(e,t){var n,r,o=t(),a=o.shapes,i=o.preDrawnLines,c=void 0===i?[]:i,t=o.drawnLines,i=o.drawnShapes,o=Object.keys(a).length,c=(a=a,n=[].concat(ht(c),ht(t)),r=s,Object.values(a).filter(function(e){return m(e.lines,n,r)})),a=c.map(function(e){return e.id});t.includes(function(e){return s.toString===e.toString})||(c.length&&c.length+i.length===o?e({type:"COMPLETE_GAME",newShapeIds:a,line:s}):c.length?e({type:"DRAW_SHAPE",newShapeIds:a,line:s}):e({type:"DRAW_LINE",line:s}))}},undoLine:function(){return function(e,t){for(var n=t().drawnLines,r=n.length-1;-1<r;){if(function(e,t){var n=t.drawnShapes,r=t.shapes,n=n.map(function(e){return r[e].lines.map(function(e){return e})}).flat();return!x(e,n)}(n[r],t())){e({type:"UNDO_CONNECTION",idx:r});break}--r}}},clearConnections:function(e){return{type:"CLEAR_CONNECTIONS",vertexId:e}}})(function(e){var t=e.state,n=e.drawLine,r=e.undoLine,o=e.clearConnections,a=e.isMobile,e=e.track;return P.createElement("div",{className:"geo-game-container"},P.createElement("h2",{className:"geo-theme"},t.theme),P.createElement(Qe,{track:e,isMobile:a,actions:{drawLine:n,undoLine:r,clearConnections:o},puzzleState:t}),P.createElement(et,{shapeCount:Object.keys(t.shapes).length-t.drawnShapes.length}))}),At=document.getElementById("portal-game-toolbar"),Tt=function(e){var t=e.track,n=e.playGame,r=e.displayDate,o=e.hasProgress,a=e.toSubLandingPage,i=e.puzzleConstructor,c=e.hasCompletedDailyPuzzle,e=k.useUser(),s=e.userType,l=e.hasLoaded,e=s.hasXwd&&o;return P.useEffect(function(){!l||s.hasXwd||c||z("hardpaywall","vertex-end-of-starter-pack-welcome")},[l,s,c]),P.createElement(P.Fragment,null,P.createElement("div",{className:O("geo-moment__container","geo-moment__welcome",{back:e}),id:"geo-welcome-daily"},P.createElement("div",{className:"geo-moment__content"},e?P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-moment__icon"}),P.createElement("h1",{className:"geo-moment__title"},"Vertex")):P.createElement(P.Fragment,null,P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"Vertex"})),e&&P.createElement("h2",{className:"geo-moment__subtitle"},"Welcome back."),P.createElement(Ot,{hasProgress:o,hasCompletedDailyPuzzle:c,hasLoaded:l,userType:s}),P.createElement("div",{className:"geo-moment__actions"},P.createElement(kt,{userType:s,hasCompletedDailyPuzzle:c,hasProgress:o,toSubLandingPage:a,playGame:n,track:t})),P.createElement(St,null,P.createElement("span",{className:"pz-moment__info-date"},r)),P.createElement(St,null,"By ".concat(i)))))},jt=function(e){var t=e.track,n=e.playGame;return P.createElement(P.Fragment,null,P.createElement("div",{id:"geo-welcome-first-visit",className:"geo-moment__container geo-moment__welcome"},P.createElement("div",{className:"geo-moment__content"},P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"Vertex"}),P.createElement(Et,{text:"Connect the dots and <br /> reveal the hidden picture."}),P.createElement("div",{className:"geo-moment__actions"},P.createElement(_t,{text:"Play",action:function(){n(),t("START_GAME")}})),P.createElement(St,null,P.createElement("span",{className:"pz-moment__info-date"},"Tutorial Puzzle")),P.createElement(St,null,"By Noca Wu"))))},Lt=function(e){var t=e.track,n=e.playGame,r=e.hasProgress,e=e.id;return P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-moment__container geo-moment__welcome back",id:"geo-welcome-starter-pack"},P.createElement("div",{className:"geo-moment__content"},P.createElement("div",{className:"geo-moment__icon"}),P.createElement("h3",{className:"geo-moment__title"},"Vertex"),P.createElement("h2",{className:"geo-moment__subtitle"},"Welcome back."),P.createElement(Et,{text:r?"Reveal the full picture":"Start connecting the dots."}),P.createElement("div",{className:"geo-moment__actions"},P.createElement(_t,{text:r?"Continue":"Play",action:function(){n(),t(r?"CONTINUE":"START_GAME")}})),P.createElement(St,null,P.createElement("span",{className:"pz-moment__info-date"},"Starter Puzzle ".concat(parseInt(e)+1))),P.createElement(St,null,"By Noca Wu"))))},Dt={header:"Try A Different Game",title:"Spelling Bee",text:"Tackle <strong>today&apos;s puzzle.</strong>",containerClassNames:["sb"],link:"/puzzles/spelling-bee"};function Nt(){return(Nt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var It=function(e){var t=e.track,n=e.backToGame,r=e.toSubLandingPage,o=k.useUser(),e=o.userType,o=o.hasLoaded;return P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-moment__container geo-moment__congrats",id:"geo-congrats-daily"},P.createElement("div",{className:"geo-moment__content"},P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"Nice drawing!"}),P.createElement(Et,{text:"Come back tomorrow to play a new puzzle."}),P.createElement("div",{className:"geo-moment__actions"},P.createElement("button",{type:"button",className:"geo-moment__button--link",onClick:function(){n(),t("ADMIRE_MY_PUZZLE")}},"Admire your puzzle."),o&&!e.hasXwd&&P.createElement(_t,{text:"Subscribe",action:function(){return r("vertexPreviewPageNonsubs")}}),P.createElement(_t,{text:"View all games",color:o&&!e.hasXwd?"secondary":"primary",action:function(){var e;window.isHybridWebView&&window.NativeBridge?window.NativeBridge.gamesBackToHub():window.isPlayTab?((e=document.createElement("a")).href="nytimes://play",e.click()):window.location.href="/crosswords",t("BACK_TO_HUB")}}))),P.createElement(zt,Nt({},Dt,{clickHandler:function(){return l.trackClick({name:"vertex",context:"spelling-bee",element:{name:"vertex",label:"next-game"}})}}))))},Mt=function(e){var t=e.track,n=e.backToGame;return P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-moment__container geo-moment__congrats",id:"geo-congrats-tutorial"},P.createElement("div",{className:"geo-moment__content"},P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"Nice drawing!"}),P.createElement(Et,{text:"You know how to play, so let's solve some puzzles."}),P.createElement("div",{className:"geo-moment__actions"},P.createElement(_t,{text:"Play",action:function(){n(),t("START_GAME")}})))))};function Rt(){return(Rt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}var Ft=function(e){var t=e.track,n=e.backToGame,r=e.toSubLandingPage,e=k.useUser(),o=e.userType,a=e.hasLoaded;return P.useEffect(function(){a&&!o.hasXwd&&z("hardpaywall","vertex-end-of-starter-pack-congrats")},[a,o]),P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-moment__container geo-moment__congrats",id:"geo-congrats-starter-pack"},P.createElement("div",{className:"geo-moment__content"},P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"Congrats on your masterpiece!"}),P.createElement(Et,{text:o.hasXwd?"As a Games subscriber, you can play Vertex every day.":"Subscribe to New York Times Games to play Vertex every day."}),P.createElement("div",{className:"geo-moment__actions"},a&&!o.hasXwd&&P.createElement(_t,{text:"Subscribe",action:function(){return r("vertexCongratsMomentEndOfStarterPack")}}),o.hasXwd?P.createElement(_t,{text:"Today’s Puzzle",action:function(){n(),t("START_GAME")}}):P.createElement(_t,{text:"Today’s Puzzle",color:"secondary",icon:"locked",action:function(){return r("vertexTodaysPuzzle")}}))),P.createElement(zt,Rt({},Dt,{clickHandler:function(){return l.trackClick({name:"vertex",label:a&&!o.hasXwd?"hardpaywall":null,context:"spelling-bee",element:{name:"vertex",label:"next-game"}})}}))))};function Xt(){return(Xt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Bt(e){switch(e.congrats){case"tutorial":return P.createElement(Mt,e);case"midway starter pack":return P.createElement(Ut,e);case"starter pack":return P.createElement(Ft,e);default:return P.createElement(It,e)}}var Ut=function(e){var t=e.track,n=e.backToGame;return P.createElement(P.Fragment,null,P.createElement("div",{className:"geo-moment__container geo-moment__congrats",id:"geo-congrats-midway-starter"},P.createElement("div",{className:"geo-moment__content"},P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"You're becoming an artist."}),P.createElement(Et,{text:"Keep up the good work."}),P.createElement("div",{className:"geo-moment__actions"},P.createElement(_t,{text:"Next Puzzle",action:function(){n(),t("START_GAME")}}))),P.createElement(zt,Xt({},Dt,{clickHandler:function(){return l.trackClick({name:"vertex",context:"spelling-bee",element:{name:"vertex",label:"next-game"}})}}))))},Gt="https://www.nytimes.com/subscription/games";function Yt(){return(Yt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n,r=arguments[t];for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e}).apply(this,arguments)}function Vt(t,e){var n,r=Object.keys(t);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(t),e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)),r}function Ht(r){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?Vt(Object(o),!0).forEach(function(e){var t,n;t=r,e=o[n=e],n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):Vt(Object(o)).forEach(function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(o,e))})}return r}var Wt=e.connect(function(e){return{id:e.id,drawnLines:e.drawnLines,drawnShapes:e.drawnShapes,displayDate:e.displayDate,puzzleConstructor:e.puzzleConstructor,hasCompletedTutorial:e.hasCompletedTutorial,hasCompletedStarterPack:e.hasCompletedStarterPack,starterPackPuzzles:e.starterPackPuzzles}})(function(r){function e(){var e=document.getElementById("js-hook-concierge"),t=document.getElementById("js-hook-concierge__intro"),n=document.getElementById("js-hook-concierge__game");r.startGame(!0),Se(e,t,n,Xe),l.mobileNavTools.activate()}var t=r.children,n=r.drawnLines,o=r.drawnShapes;P.useEffect(function(){var o;C(100).then((o=document.getElementById("pz-loading-bar").children[0],new Promise(function(r){(function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:10;o.style.right="".concat(Math.max(100-t,0),"%");var n=window.localStorage.getItem("pauseLoader");t<=100||n?C(30+150*Math.random()).then(function(){e(t+20*Math.random())}):r()})()}).then(function(){var e=document.getElementById("js-hook-concierge"),t=document.getElementById("js-hook-concierge__loading"),n=document.getElementById("js-hook-concierge__intro");Se(e,t,n)})))},[]);o=Ht(Ht({},r),{},{toHub:function(){window.location.assign("/crosswords")},hasProgress:0<n.length||0<o.length,toSubLandingPage:function(e){e=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:window;if(!t||!t.navigationLinks||!t.navigationLinks.subscribe)return Gt;t=t.navigationLinks.subscribe;return e&&t[e]?t[e]:Gt}(e);!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return 0===e.indexOf("nytimes://")||0===e.indexOf("nytxwd://")}(e)?window.location.assign(e):function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:document;if(!e)return;t=t.createElement("a");t.href=e,t.click()}(e)}});return P.createElement("main",{className:"pz-concierge geo-concierge",id:"js-hook-concierge"},P.createElement("section",{className:"pz-concierge__frame on-stage geo-loading","data-concierge-frame":"loading",id:"js-hook-concierge__loading"},P.createElement(bt,{icon:"vertex"}),P.createElement(wt,{text:"Vertex"}),P.createElement(Et,{text:"Start connecting the dots..."}),P.createElement("div",{className:"geo-loader",id:"pz-loading-bar"},P.createElement("div",{className:"geo-loader__fill"}))),P.createElement("section",{className:"pz-concierge__frame geo-moment",id:"js-hook-concierge__intro"},P.createElement(Pt,Yt({playGame:e},o))),P.createElement("section",{className:"pz-concierge__frame geo-game",id:"js-hook-concierge__game"},t),P.createElement("section",{className:"pz-concierge__frame geo-moment",id:"js-hook-concierge__congrats"},P.createElement(Bt,Yt({playGame:e,backToGame:function(){var e=document.getElementById("js-hook-concierge"),t=document.getElementById("js-hook-concierge__congrats"),n=document.getElementById("js-hook-concierge__game");Se(e,t,n,Xe)}},o))))});function qt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a=[],i=!0,c=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(a.push(r.value),!t||a.length!==t);i=!0);}catch(e){c=!0,o=e}finally{try{i||null==n.return||n.return()}finally{if(c)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return Zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Zt(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Kt=e.connect(function(e){return{id:e.id,isComplete:e.isComplete,dailyPuzzle:e.dailyPuzzle,tutorialPuzzles:e.tutorialPuzzles,starterPackPuzzles:e.starterPackPuzzles,hasCompletedTutorial:e.hasCompletedTutorial,hasCompletedStarterPack:e.hasCompletedStarterPack}},{resetGame:function(){return{type:"RESET_GAME"}},setCurrentPuzzle:vt,completeTutorial:function(){return{type:"COMPLETE_TUTORIAL"}},debugCompleteGame:function(){return{type:"DEBUG_COMPLETE_GAME"}},nextTutorialPuzzle:function(){return function(e,t){var n=t(),r=n.id,t=n.tutorialPuzzles,n=t.findIndex(function(e){return e.id===r}),n=t[n+1];e(vt(n))}},completeStarterPack:function(){return{type:"COMPLETE_STARTER_PACK"}},nextStarterPackPuzzle:function(){return function(e,t){var n=t(),r=n.id,t=n.starterPackPuzzles,n=t.findIndex(function(e){return e.id===r}),n=t[n+1];e(vt(n))}}})(function(e){function t(){u(!0),l(m[0]),L("tutorial",!0)}function n(){h(!0),S.hasXwd&&l(c),L("starter-pack",!0)}var r=e.id,o=e.isMobile,a=e.resetGame,i=e.isComplete,c=e.dailyPuzzle,s=e.tutorialPuzzles,l=e.setCurrentPuzzle,u=e.completeTutorial,d=e.debugCompleteGame,m=e.starterPackPuzzles,p=e.nextTutorialPuzzle,h=e.completeStarterPack,f=e.hasCompletedTutorial,v=e.nextStarterPackPuzzle,g=e.hasCompletedStarterPack,y=qt(P.useState("daily"),2),b=y[0],w=y[1],e=qt(P.useState(!1),2),E=e[0],y=e[1],S=k.useUser().userType;P.useEffect(function(){i&&(f?g?E&&(w("daily"),z("congrats-modal","vertex"),z("next-game","vertex","spelling-bee"),C(3e3).then(H)):A(r,m)?(w("starter pack"),z("congrats-modal","vertex"),z("next-game","vertex","spelling-bee"),C(3e3).then(H).then(n)):(w("midway starter pack"),z("congrats-modal","vertex"),z("next-game","vertex","spelling-bee"),C(3e3).then(H).then(v)):A(r,s)?(w("tutorial"),z("congrats-modal","vertex"),C(3e3).then(H).then(t)):C(600).then(p))},[i]);function _(e){return G(e,r,f||g?f&&!g?"starter-pack":"daily":"tutorial")}e=function(){Le.open("help"),_("RULES")};return P.createElement("div",{className:"geo-main-container"},P.createElement(yt,{resetGame:function(){a(),_("RESET")},debugCompleteGame:d,skipTutorial:E&&!f?function(){w("tutorial"),H().then(t),_("SKIP_TUTORIAL")}:null,openRulesModal:e}),P.createElement(Te,null),P.createElement(Wt,{track:_,congrats:b,startGame:y,openRulesModal:e,hasStartedGame:E,saveAndCompleteTutorial:t,tutorialPuzzles:s,hasCompletedDailyPuzzle:i},P.createElement(xt,{isMobile:o,track:_})))}),$t=document.getElementById("pz-game-root"),Jt=l.getGameData();c.render(P.createElement(e.Provider,{store:function(e){var t=[a.applyMiddleware(u,gt)];window.__REDUX_DEVTOOLS_EXTENSION__&&t.push(window.__REDUX_DEVTOOLS_EXTENSION__());var i,c,n=e.api,r=n.tutorial,e=n.starterPuzzles,n=pt(n,ut),n=lt(n,"daily"),r=r.map(function(e){return lt(e,"tutorial")}),e=e.map(function(e){return lt(e,"starter-pack")}),n=mt(mt(mt({},Ct),r[0]),{},{tutorialPuzzles:r,starterPackPuzzles:e,dailyPuzzle:n,hasCompletedTutorial:!1,hasCompletedStarterPack:!1}),o=a.createStore(st,n,a.compose.apply(void 0,t));return i=o,c=function(e,t){return o.dispatch(vt(e,t))},I().then(function(e){var t=e.packId,n=void 0===t?"":t,r=e.isComplete,t=void 0!==r&&r,e=i.getState(),r=e.tutorialPuzzles,o=e.starterPackPuzzles,a=e.dailyPuzzle,e="tutorial"===n&&t,t="starter-pack"===n&&t;e?i.dispatch({type:"COMPLETE_TUTORIAL"}):t&&i.dispatch({type:"COMPLETE_STARTER_PACK"}),t?F(a.id).then(function(e){return c(a,e)}):e?X("starter-pack").then(function(e){var n={},t=g(o).reverse().find(function(t){return!!(n=e&&e.find(function(e){return e.id===t.id}))&&t});t?c(t,n):c(o[0])}):c(r[0])}),setInterval(function(){var e=i.getState();"tutorial"!==e.puzzleType&&R(e)},1e4),window.addEventListener("online",function(){var e=i.getState();"tutorial"!==e.puzzleType&&R(e)}),o}(Jt)},P.createElement(k.UserProvider,null,P.createElement(Kt,{isMobile:Jt.isMobile}))),$t)});
//# sourceMappingURL=vertex.1e71ba669a95430b01dcfd05e0946bdf1f7fcd81.js.map