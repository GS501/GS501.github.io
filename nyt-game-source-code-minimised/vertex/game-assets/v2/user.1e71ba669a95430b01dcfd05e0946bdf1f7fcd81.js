!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("react"),require("react-dom"),require("foundation")):"function"==typeof define&&define.amd?define(["exports","react","react-dom","foundation"],t):t((e=e||self).User={},e.React,e.ReactDOM,e.Foundation)}(this,function(e,u,t,s){"use strict";var c="default"in u?u.default:u;t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t;var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,t)};function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}function f(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],n=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return{value:(e=e&&n>=e.length?void 0:e)&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var r="function"==typeof Symbol&&e[Symbol.iterator];if(!r)return e;var n,o,i=r.call(e),a=[];try{for(;(void 0===t||0<t--)&&!(n=i.next()).done;)a.push(n.value)}catch(e){o={error:e}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(o)throw o.error}}return a}function p(e,t){for(var r=0,n=t.length,o=e.length;r<n;r++,o++)e[o]=t[r];return e}function h(e){return"function"==typeof e}var o,y=((o=(o=function(t){return function(e){t(this),this.message=e?e.length+" errors occurred during unsubscription:\n"+e.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=e}})(function(e){Error.call(e),e.stack=(new Error).stack})).prototype=Object.create(Error.prototype),o.prototype.constructor=o);function i(e,t){!e||0<=(t=e.indexOf(t))&&e.splice(t,1)}var a=(l.prototype.unsubscribe=function(){var t,e,r,n,o;if(!this.closed){this.closed=!0;var i=this._parentage;if(i)if(this._parentage=null,Array.isArray(i))try{for(var a=f(i),u=a.next();!u.done;u=a.next())u.value.remove(this)}catch(e){t={error:e}}finally{try{u&&!u.done&&(e=a.return)&&e.call(a)}finally{if(t)throw t.error}}else i.remove(this);i=this.initialTeardown;if(h(i))try{i()}catch(e){o=e instanceof y?e.errors:[e]}i=this._teardowns;if(i){this._teardowns=null;try{for(var s=f(i),c=s.next();!c.done;c=s.next()){var l=c.value;try{b(l)}catch(e){o=null!=o?o:[],e instanceof y?o=p(p([],d(o)),d(e.errors)):o.push(e)}}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(r)throw r.error}}}if(o)throw new y(o)}},l.prototype.add=function(e){var t;if(e&&e!==this)if(this.closed)b(e);else{if(e instanceof l){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._teardowns=null!==(t=this._teardowns)&&void 0!==t?t:[]).push(e)}},l.prototype._hasParent=function(e){var t=this._parentage;return t===e||Array.isArray(t)&&t.includes(e)},l.prototype._addParent=function(e){var t=this._parentage;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e},l.prototype._removeParent=function(e){var t=this._parentage;t===e?this._parentage=null:Array.isArray(t)&&i(t,e)},l.prototype.remove=function(e){var t=this._teardowns;t&&i(t,e),e instanceof l&&e._removeParent(this)},l.EMPTY=((N=new l).closed=!0,N),l);function l(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._teardowns=null}function v(e){return e instanceof a||e&&"closed"in e&&h(e.remove)&&h(e.add)&&h(e.unsubscribe)}function b(e){h(e)?e():e.unsubscribe()}var m,g,w={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},_={setTimeout:(g=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var r=_.delegate;return((null==r?void 0:r.setTimeout)||setTimeout).apply(void 0,p([],d(e)))},E.toString=function(){return g.toString()},E),clearTimeout:(m=function(e){var t=_.delegate;return((null==t?void 0:t.clearTimeout)||clearTimeout)(e)},S.toString=function(){return m.toString()},S),delegate:void 0};function S(e){return m.apply(this,arguments)}function E(){return g.apply(this,arguments)}function O(){}var x,P=(r(j,x=a),j.create=function(e,t,r){return new I(e,t,r)},j.prototype.next=function(e){this.isStopped||this._next(e)},j.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},j.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},j.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,x.prototype.unsubscribe.call(this),this.destination=null)},j.prototype._next=function(e){this.destination.next(e)},j.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},j.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},j);function j(e){var t=x.call(this)||this;return t.isStopped=!1,e?v(t.destination=e)&&e.add(t):t.destination=z,t}var T,I=(r(L,T=P),L);function L(e,t,r){var n,o,i=T.call(this)||this;return h(e)?o=e:e&&(o=e.next,t=e.error,r=e.complete,i&&w.useDeprecatedNextContext?(n=Object.create(e)).unsubscribe=function(){return i.unsubscribe()}:n=e,o=null==o?void 0:o.bind(n),t=null==t?void 0:t.bind(n),r=null==r?void 0:r.bind(n)),i.destination={next:o?A(o):O,error:A(null!=t?t:k),complete:r?A(r):O},i}function A(n){return function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];try{n.apply(void 0,p([],d(e)))}catch(e){t=e,_.setTimeout(function(){throw t})}}}function k(e){throw e}var z={closed:!0,next:O,error:k,complete:O},N="function"==typeof Symbol&&Symbol.observable||"@@observable";function U(e){return e}D.prototype.lift=function(e){var t=new D;return t.source=this,t.operator=e,t},D.prototype.subscribe=function(e,t,r){var n,e=(n=e)&&n instanceof P||function(e){return e&&h(e.next)&&h(e.error)&&h(e.complete)}(n)&&v(n)?e:new I(e,t,r),t=this.operator,r=this.source;return e.add(t?t.call(e,r):r?this._subscribe(e):this._trySubscribe(e)),e},D.prototype._deprecatedSyncErrorSubscribe=function(e){var t=e;t._syncErrorHack_isSubscribing=!0;var r=this.operator;if(r)e.add(r.call(e,this.source));else try{e.add(this._subscribe(e))}catch(e){t.__syncError=e}for(var n=t;n;){if("__syncError"in n)try{throw n.__syncError}finally{e.unsubscribe()}n=n.destination}t._syncErrorHack_isSubscribing=!1},D.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){t.error(e)}},D.prototype.forEach=function(n,e){var o=this;return new(e=C(e))(function(e,t){var r=o.subscribe(function(e){try{n(e)}catch(e){t(e),null!=r&&r.unsubscribe()}},t,e)})},D.prototype._subscribe=function(e){var t;return null===(t=this.source)||void 0===t?void 0:t.subscribe(e)},D.prototype[N]=function(){return this},D.prototype.pipe=function(){for(var t,e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return e.length?(0===(t=e).length?U:1===t.length?t[0]:function(e){return t.reduce(function(e,t){return t(e)},e)})(this):this},D.prototype.toPromise=function(e){var n=this;return new(e=C(e))(function(e,t){var r;n.subscribe(function(e){return r=e},function(e){return t(e)},function(){return e(r)})})},D.create=function(e){return new D(e)},N=D;function D(e){e&&(this._subscribe=e)}function C(e){return null!==(e=null!=e?e:w.Promise)&&void 0!==e?e:Promise}function H(e){var t=null==e||null===(t=e.user)||void 0===t||null===(i=t.userInfo)||void 0===i?void 0:i.regiId;-1!==document.cookie.indexOf("NYT-S")&&null===t&&console.error("Samizdat error: invalid user request");var r,n=!!t,o=(null==e||null===(a=e.user)||void 0===a||null===(r=a.userInfo)||void 0===r?void 0:r.subscriptions)||[],i=!!(o=o.map(function(e){return e.toLowerCase()})).find(function(e){return"mm"===e||"msd"===e||"mtd"===e}),e=!!o.find(function(e){return"xwd"===e}),a=!!o.find(function(e){return"hd"===e}),o=(r=i,o=e,n?r&&o?"sub,cr":r?"sub":o?"cr":"reg":"anon");return{regiId:t,isLoggedIn:n,hasXwd:e,hasDigi:i,hasHd:a,entitlement:o,inShortzMode:!1}}function M(){var e=(t=R()).hasLoaded,t=t.userType;return!e||t.isLoggedIn?null:(t=s.appendSupportedParams(window.navigationLinks.login,"&asset=navigation-bar"),c.createElement("a",{href:t,className:"pz-nav__button white"},"Log In"))}function X(){var e=(t=R()).hasLoaded,t=t.userType;return e&&t.isLoggedIn?c.createElement("a",{href:"".concat(window.navigationLinks.logout,"&asset=navigation-bar"),className:"pz-nav__button gray"},"Log Out"):null}function q(){var e=R(),t=e.userType;return!e.hasLoaded||t.hasXwd?null:c.createElement("a",{href:window.navigationLinks.subscribe.default,className:"pz-nav__button"},"Subscribe")}function B(){var e=(t=R()).hasLoaded,t=t.userType;return e&&t.isLoggedIn?c.createElement(c.Fragment,null,c.createElement("h4",{className:"pz-nav-drawer__heading"},"Profile"),c.createElement("a",{href:window.navigationLinks.account,className:"pz-nav-drawer__link"},"Account details")):null}var F=new N(function(t){if("undefined"!=typeof window){var r=window.userQueryXHR;if(r){if(4===r.readyState){var e=JSON.parse(r.responseText);return t.next(e.data),void t.complete()}e={once:!0};r.addEventListener("timeout",t.error,e),r.addEventListener("error",t.error,e),r.addEventListener("load",function(){var e=JSON.parse(r.responseText);t.next(e.data),t.complete()},e)}else t.error("The UserQuery XHR was not initialized.")}else t.error("Cannot fetch user info on the server.")}),G={isLoggedIn:!1,hasXwd:!1,hasDigi:!1,hasHd:!1,entitlement:"anon",regiId:"",inShortzMode:!1,nytsCookie:""},Q=u.createContext({userType:G,updateUserType:function(){},hasLoaded:!1}),R=function(){return u.useContext(Q)};function J(t,e){var r,n=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)),n}function Y(n){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?J(Object(o),!0).forEach(function(e){var t,r;t=n,e=o[r=e],r in t?Object.defineProperty(t,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(o)):J(Object(o)).forEach(function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(o,e))})}return n}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,i=[],a=!0,u=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(i.push(n.value),!t||i.length!==t);a=!0);}catch(e){u=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(u)throw o}}return i}}(e,t)||function(e,t){if(e){if("string"==typeof e)return W(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?W(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function W(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function $(){return($=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r,n=arguments[t];for(r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}e.NavUserActions=function(){return[t.createPortal(c.createElement(c.Fragment,null,c.createElement(q,null),c.createElement(M,null)),document.getElementById(s.jsHook("nav-actions"))),t.createPortal(c.createElement(c.Fragment,null,c.createElement(B,null),c.createElement("div",{className:"pz-nav-drawer__account-actions"},c.createElement(X,null),c.createElement(q,null),c.createElement(M,null))),document.getElementById(s.jsHook("nav-profile")))]},e.UserProvider=function(e){function t(t){return i(function(e){return Y(Y({},e),t)})}var r=e.children,n=V(u.useState(G),2),o=n[0],i=n[1],e=V(u.useState(!1),2),n=e[0],a=e[1];return u.useEffect(function(){if(!window.isHybridWebView||!window.NativeBridge){var e=F.subscribe({next:function(e){t(H(e)),a(!0)},error:function(e){console.error("There was an error in the userQueryObservable: ".concat(e))},complete:function(){}});return function(){e.unsubscribe()}}window.NativeBridge.gamesGetUserDetails().then(function(e){if(e.error)throw new Error(e.error);e=e.values.gamesGetUserDetails;t({isLoggedIn:e.isUserLoggedIn,hasXwd:e.isSubscribed,regiId:e.regiID,nytsCookie:e.nytsCookie}),a(!0)}).catch(function(e){console.error("Getting user details failed",e)})},[]),u.useEffect(function(){o.regiId&&s.xhr.get("".concat(null===s.env||void 0===s.env?void 0:s.env.hostname,"/puzzles/shortz/").concat(o.regiId)).then(function(e){t({inShortzMode:e})}).catch(function(e){console.error("Getting shortz mode details failed",e)})},[o.regiId]),c.createElement(Q.Provider,{value:{userType:o,updateUserType:t,hasLoaded:n}},r)},e.createUserInfoObject=H,e.useUser=R,e.userQueryObservable=F,e.withUser=function(r){return function(e){var t=R();return c.createElement(r,$({user:t},e))}},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=user.1e71ba669a95430b01dcfd05e0946bdf1f7fcd81.js.map